<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Dona Paraguay</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-14PSV7R8YT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-14PSV7R8YT');
</script>
</head>
<body>

<%- include('partials/header.html') %>

<% if (locals.userProfile) { %>
<main class="container">
    <div class="profile-header">
        <div class="profile-avatar">
            <img src="<%= userProfile.profilePic %>" alt="Foto de perfil de <%= userProfile.username %>">
        </div>
        <div class="profile-info">
            <h1>
                <%= userProfile.username %>
                <% if (userProfile.isVerified) { %>
                    <i class="fas fa-check-circle verification-badge" title="Organizador Verificado"></i>
                <% } %>
            </h1>

            <div class="profile-stats">
                <span><strong><%= campaigns.length %></strong> Campañas</span>
                <span><strong><%= new Intl.NumberFormat('es-PY').format(totalDonated) %> Gs.</strong> Total Donado</span>
                <span><strong><%= userProfile.followers.length %></strong> Seguidores</span>
            </div>
            
            <% if (userProfile.bio) { %>
                <p class="profile-bio"><%- userProfile.bio %></p>
            <% } %>

            <div class="profile-meta-info">
                <% if (userProfile.location) { %>
                    <span class="meta-item">
                        <i class="fas fa-map-marker-alt"></i> <%= userProfile.location %>
                    </span>
                <% } %>
                <% if (userProfile.socialLinks && (userProfile.socialLinks.facebook || userProfile.socialLinks.instagram || userProfile.socialLinks.twitter)) { %>
                    <div class="social-links">
                        <% if (userProfile.socialLinks.facebook) { %><a href="<%= userProfile.socialLinks.facebook %>" target="_blank" rel="noopener noreferrer" class="social-icon facebook"><i class="fab fa-facebook-f"></i></a><% } %>
                        <% if (userProfile.socialLinks.instagram) { %><a href="<%= userProfile.socialLinks.instagram %>" target="_blank" rel="noopener noreferrer" class="social-icon instagram"><i class="fab fa-instagram"></i></a><% } %>
                        <% if (userProfile.socialLinks.twitter) { %><a href="<%= userProfile.socialLinks.twitter %>" target="_blank" rel="noopener noreferrer" class="social-icon twitter"><i class="fab fa-twitter"></i></a><% } %>
                    </div>
                <% } %>
            </div>

            <div class="profile-actions">
    <a href="/settings/profile" class="btn btn-secondary">Editar Perfil</a>
    <% if (userProfile.isVerified) { %>
        <a href="/new-campaign" class="btn btn-primary">Crear Campaña</a>
    <% } else { %>
         <a href="/verify-account" class="btn btn-primary">Verificarme para crear Campaña</a>
    <% } %>
</div>
        </div>
    </div>

    <div class="profile-tabs">
        <a href="#" class="tab-link active" data-tab="campaigns"><i class="fas fa-bullhorn"></i> MIS CAMPAÑAS</a>
        <a href="#" class="tab-link" data-tab="donations"><i class="fas fa-heart"></i> MIS DONACIONES</a>
        <a href="#" class="tab-link" data-tab="badges"><i class="fas fa-trophy"></i> INSIGNIAS</a>
    </div>

    <div id="campaigns-content" class="tab-content active">
        <div class="post-grid">
            <% if (campaigns && campaigns.length > 0) { %>
                <% campaigns.forEach(campaign => { %>
                    <%- include('partials/campaign-card.html', { campaign: campaign }) %>
                <% }); %>
            <% } else { %>
                <div class="no-results-card">
                    <h3>Aún no has creado ninguna campaña</h3>
                    <p>¡Anímate a crear tu primera campaña y empieza a recaudar fondos para tu causa!</p>
                    <a href="/new-campaign" class="btn btn-primary">Crear mi primera campaña</a>
                </div>
            <% } %>
        </div>
    </div>
    
    <div id="donations-content" class="tab-content" style="display: none;">
    <% if (userDonations && userDonations.length > 0) { %>
        <div class="donations-list-container">
            <% userDonations.forEach(donation => { %>
                <div class="donation-history-card">
                    <div class="card-main-info">
                        <% if (donation.campaignId) { %>
                            <a href="/campaign/<%= donation.campaignId._id %>" class="campaign-title"><%= donation.campaignId.title %></a>
                        <% } else { %>
                            <span class="campaign-title text-muted">Campaña eliminada</span>
                        <% } %>
                        <div class="donation-amount">
                            <%= new Intl.NumberFormat('es-PY').format(donation.campaignAmount) %> Gs.
                        </div>
                    </div>
                    <div class="card-meta-info">
                        <span><i class="fas fa-calendar-alt"></i> <%= formatDate(donation.createdAt) %></span>
                        <span class="badge status-<%= donation.status.toLowerCase() %>"><%= donation.status %></span>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <div class="no-results-card">
            <h3>Aún no has realizado ninguna donación</h3>
            <p>Explora las campañas y encuentra una causa para apoyar.</p>
            <a href="/campaigns" class="btn btn-primary">Ver Campañas</a>
        </div>
    <% } %>
</div>

 <div id="badges-content" class="tab-content" style="display: none;">
        <div class="badges-grid-container">
            <% if (userProfile.badges && userProfile.badges.length > 0) { %>
                <% userProfile.badges.forEach(badge => { %>
                    <div class="badge-card-item" title="<%= badge.description %>">
                        <div class="badge-icon-circle">
                            <i class="fas <%= badge.icon %>"></i>
                        </div>
                        <h4><%= badge.name %></h4>
                        <p><%= badge.description %></p>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="no-badges-state">
                    <i class="fas fa-medal fa-3x" style="color: #ddd; margin-bottom: 1rem;"></i>
                    <h3>Aún no tienes insignias</h3>
                    <p>¡Dona a tu primera campaña para ganar tu medalla de "Primer Donativo"!</p>
                    <a href="/campaigns" class="btn btn-sm btn-primary mt-2">Explorar Campañas</a>
                </div>
            <% } %>
        </div>
    </div>
</main>
<% } %>

<%- include('partials/footer.html') %>

<script>
// Script para manejar las pestañas
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = tab.getAttribute('data-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            tabContents.forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            const activeContent = document.getElementById(targetId + '-content');
            if (activeContent) {
                activeContent.style.display = 'block'; // Usamos block para todos
                activeContent.classList.add('active');
            }
        });
    });
});
</script>

</body>
</html>